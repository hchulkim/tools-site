{
  "hash": "a9a8c90d9b5f81eb1205b9694cea6060",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Geospatial with R\"\nsubtitle: \"Handling raster data with `terra`\"\nexecute:\n  freeze: auto\n---\n\n\n\n\nThis is my practice sections following [R as GIS for Economists](https://tmieno2.github.io/R-as-GIS-for-Economists-Quarto/).\n\n### Basics\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif (!require(\"pacman\")) install.packages(\"pacman\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: pacman\n```\n\n\n:::\n\n```{.r .cell-code}\npacman::p_load(terra, raster, mapview, dplyr, sf, lubridate, downloader)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n(\n  IA_cdl_2015 <- raster::raster(\"Data/IA_cdl_2015.tif\")\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass      : RasterLayer \ndimensions : 11671, 17795, 207685445  (nrow, ncol, ncell)\nresolution : 30, 30  (x, y)\nextent     : -52095, 481755, 1938165, 2288295  (xmin, xmax, ymin, ymax)\ncrs        : +proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \nsource     : IA_cdl_2015.tif \nnames      : Layer_1 \nvalues     : 0, 229  (min, max)\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nIA_cdl_2016 <- raster::raster(\"Data/IA_CDL_2016.tif\")\n\n#--- stack the two ---#\n(\n  IA_cdl_stack <- raster::stack(IA_cdl_2015, IA_cdl_2016)\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass      : RasterStack \ndimensions : 11671, 17795, 207685445, 2  (nrow, ncol, ncell, nlayers)\nresolution : 30, 30  (x, y)\nextent     : -52095, 481755, 1938165, 2288295  (xmin, xmax, ymin, ymax)\ncrs        : +proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \nnames      : Layer_1, IA_CDL_2016 \nmin values :       0,           0 \nmax values :     229,         241 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# I am not evaluating this cell because it takes quite some time to execute.\n#--- stack the two ---#\nIA_cdl_brick <- brick(IA_cdl_stack)\n\n#--- or this works as well ---#\n# IA_cdl_brick <- brick(IA_cdl_2015, IA_cdl_2016)\n\n#--- take a look ---#\nIA_cdl_brick\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#--- convert to a SpatRaster ---#\nIA_cdl_2015_sr <- terra::rast(IA_cdl_2015)\n\n#--- convert to a SpatRaster ---#\nIA_cdl_stack_sr <- terra::rast(IA_cdl_stack)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: [rast] CRS do not match\n```\n\n\n:::\n\n```{.r .cell-code}\n#--- take a look ---#\nIA_cdl_2015_sr\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass       : SpatRaster \ndimensions  : 11671, 17795, 1  (nrow, ncol, nlyr)\nresolution  : 30, 30  (x, y)\nextent      : -52095, 481755, 1938165, 2288295  (xmin, xmax, ymin, ymax)\ncoord. ref. : +proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \nsource      : IA_cdl_2015.tif \nname        : Layer_1 \nmin value   :       0 \nmax value   :     229 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# create a single-layer from multiple single-layer\nIA_cdl_2016_sr <- terra::rast(IA_cdl_2016)\n\n# concatenate\n(\n    IA_cdl_ml_sr <- c(IA_cdl_2015_sr, IA_cdl_2016_sr)\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: [rast] CRS do not match\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass       : SpatRaster \ndimensions  : 11671, 17795, 2  (nrow, ncol, nlyr)\nresolution  : 30, 30  (x, y)\nextent      : -52095, 481755, 1938165, 2288295  (xmin, xmax, ymin, ymax)\ncoord. ref. : +proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \nsources     : IA_cdl_2015.tif  \n              IA_CDL_2016.tif  \ncolor table : 2 \nnames       : Layer_1, IA_CDL_2016 \nmin values  :       0,           0 \nmax values  :     229,         241 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nIA_cdl_stack_sr %>% raster::raster()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass      : RasterLayer \ndimensions : 11671, 17795, 207685445  (nrow, ncol, ncell)\nresolution : 30, 30  (x, y)\nextent     : -52095, 481755, 1938165, 2288295  (xmin, xmax, ymin, ymax)\ncrs        : +proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \nsource     : IA_cdl_2015.tif \nnames      : Layer_1 \nvalues     : 0, 229  (min, max)\n```\n\n\n:::\n\n```{.r .cell-code}\n#  %>% raster::stack()\n#  %>% raster::brick() \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#--- Illinois county boundary ---#\n(\n  IL_county <- \n    tigris::counties(\n      state = \"Illinois\", \n      progress_bar = FALSE\n    ) %>%\n    dplyr::select(STATEFP, COUNTYFP)\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRetrieving data for the year 2022\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 102 features and 2 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -91.51308 ymin: 36.9703 xmax: -87.01994 ymax: 42.50848\nGeodetic CRS:  NAD83\nFirst 10 features:\n    STATEFP COUNTYFP                       geometry\n86       17      067 MULTIPOLYGON (((-90.90609 4...\n92       17      025 MULTIPOLYGON (((-88.69516 3...\n131      17      185 MULTIPOLYGON (((-87.89243 3...\n148      17      113 MULTIPOLYGON (((-88.91954 4...\n158      17      005 MULTIPOLYGON (((-89.37207 3...\n159      17      009 MULTIPOLYGON (((-90.53674 3...\n213      17      083 MULTIPOLYGON (((-90.1459 39...\n254      17      147 MULTIPOLYGON (((-88.46335 4...\n266      17      151 MULTIPOLYGON (((-88.48289 3...\n303      17      011 MULTIPOLYGON (((-89.16654 4...\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n(\n    IL_county_sv <- terra::vect(IL_county)\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n class       : SpatVector \n geometry    : polygons \n dimensions  : 102, 2  (geometries, attributes)\n extent      : -91.51308, -87.01994, 36.9703, 42.50848  (xmin, xmax, ymin, ymax)\n coord. ref. : lon/lat NAD83 (EPSG:4269) \n names       : STATEFP COUNTYFP\n type        :   <chr>    <chr>\n values      :      17      067\n                    17      025\n                    17      185\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n(\n    IA_cdl_2015_sr <- terra::rast(\"Data/IA_cdl_2015.tif\")\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass       : SpatRaster \ndimensions  : 11671, 17795, 1  (nrow, ncol, nlyr)\nresolution  : 30, 30  (x, y)\nextent      : -52095, 481755, 1938165, 2288295  (xmin, xmax, ymin, ymax)\ncoord. ref. : +proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \nsource      : IA_cdl_2015.tif \nname        : Layer_1 \nmin value   :       0 \nmax value   :     229 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#--- the list of path to the files ---#\nfiles_list <- c(\"Data/IA_cdl_2015.tif\", \"Data/IA_CDL_2016.tif\")\n\n#--- read the two at the same time ---#\n(\n  multi_layer_sr <- terra::rast(files_list)\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: [rast] CRS do not match\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass       : SpatRaster \ndimensions  : 11671, 17795, 2  (nrow, ncol, nlyr)\nresolution  : 30, 30  (x, y)\nextent      : -52095, 481755, 1938165, 2288295  (xmin, xmax, ymin, ymax)\ncoord. ref. : +proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \nsources     : IA_cdl_2015.tif  \n              IA_CDL_2016.tif  \ncolor table : 2 \nnames       : Layer_1, IA_CDL_2016 \nmin values  :       0,           0 \nmax values  :     229,         241 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nterra::crs(IA_cdl_2015_sr)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"BOUNDCRS[\\n    SOURCECRS[\\n        PROJCRS[\\\"unnamed\\\",\\n            BASEGEOGCRS[\\\"GRS 1980(IUGG, 1980)\\\",\\n                DATUM[\\\"unknown\\\",\\n                    ELLIPSOID[\\\"GRS80\\\",6378137,298.257222101,\\n                        LENGTHUNIT[\\\"metre\\\",1,\\n                            ID[\\\"EPSG\\\",9001]]]],\\n                PRIMEM[\\\"Greenwich\\\",0,\\n                    ANGLEUNIT[\\\"degree\\\",0.0174532925199433,\\n                        ID[\\\"EPSG\\\",9122]]]],\\n            CONVERSION[\\\"Albers Equal Area\\\",\\n                METHOD[\\\"Albers Equal Area\\\",\\n                    ID[\\\"EPSG\\\",9822]],\\n                PARAMETER[\\\"Latitude of false origin\\\",23,\\n                    ANGLEUNIT[\\\"degree\\\",0.0174532925199433],\\n                    ID[\\\"EPSG\\\",8821]],\\n                PARAMETER[\\\"Longitude of false origin\\\",-96,\\n                    ANGLEUNIT[\\\"degree\\\",0.0174532925199433],\\n                    ID[\\\"EPSG\\\",8822]],\\n                PARAMETER[\\\"Latitude of 1st standard parallel\\\",29.5,\\n                    ANGLEUNIT[\\\"degree\\\",0.0174532925199433],\\n                    ID[\\\"EPSG\\\",8823]],\\n                PARAMETER[\\\"Latitude of 2nd standard parallel\\\",45.5,\\n                    ANGLEUNIT[\\\"degree\\\",0.0174532925199433],\\n                    ID[\\\"EPSG\\\",8824]],\\n                PARAMETER[\\\"Easting at false origin\\\",0,\\n                    LENGTHUNIT[\\\"metre\\\",1],\\n                    ID[\\\"EPSG\\\",8826]],\\n                PARAMETER[\\\"Northing at false origin\\\",0,\\n                    LENGTHUNIT[\\\"metre\\\",1],\\n                    ID[\\\"EPSG\\\",8827]]],\\n            CS[Cartesian,2],\\n                AXIS[\\\"easting\\\",east,\\n                    ORDER[1],\\n                    LENGTHUNIT[\\\"metre\\\",1,\\n                        ID[\\\"EPSG\\\",9001]]],\\n                AXIS[\\\"northing\\\",north,\\n                    ORDER[2],\\n                    LENGTHUNIT[\\\"metre\\\",1,\\n                        ID[\\\"EPSG\\\",9001]]]]],\\n    TARGETCRS[\\n        GEOGCRS[\\\"WGS 84\\\",\\n            DATUM[\\\"World Geodetic System 1984\\\",\\n                ELLIPSOID[\\\"WGS 84\\\",6378137,298.257223563,\\n                    LENGTHUNIT[\\\"metre\\\",1]]],\\n            PRIMEM[\\\"Greenwich\\\",0,\\n                ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n            CS[ellipsoidal,2],\\n                AXIS[\\\"geodetic latitude (Lat)\\\",north,\\n                    ORDER[1],\\n                    ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n                AXIS[\\\"geodetic longitude (Lon)\\\",east,\\n                    ORDER[2],\\n                    ANGLEUNIT[\\\"degree\\\",0.0174532925199433]],\\n            USAGE[\\n                SCOPE[\\\"Horizontal component of 3D system.\\\"],\\n                AREA[\\\"World.\\\"],\\n                BBOX[-90,-180,90,180]],\\n            ID[\\\"EPSG\\\",4326]]],\\n    ABRIDGEDTRANSFORMATION[\\\"Transformation to WGS84\\\",\\n        METHOD[\\\"Position Vector transformation (geog2D domain)\\\",\\n            ID[\\\"EPSG\\\",9606]],\\n        PARAMETER[\\\"X-axis translation\\\",0,\\n            ID[\\\"EPSG\\\",8605]],\\n        PARAMETER[\\\"Y-axis translation\\\",0,\\n            ID[\\\"EPSG\\\",8606]],\\n        PARAMETER[\\\"Z-axis translation\\\",0,\\n            ID[\\\"EPSG\\\",8607]],\\n        PARAMETER[\\\"X-axis rotation\\\",0,\\n            ID[\\\"EPSG\\\",8608]],\\n        PARAMETER[\\\"Y-axis rotation\\\",0,\\n            ID[\\\"EPSG\\\",8609]],\\n        PARAMETER[\\\"Z-axis rotation\\\",0,\\n            ID[\\\"EPSG\\\",8610]],\\n        PARAMETER[\\\"Scale difference\\\",1,\\n            ID[\\\"EPSG\\\",8611]]]]\"\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# index\nIA_cdl_stack_sr[[2]]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass       : SpatRaster \ndimensions  : 11671, 17795, 1  (nrow, ncol, nlyr)\nresolution  : 30, 30  (x, y)\nextent      : -52095, 481755, 1938165, 2288295  (xmin, xmax, ymin, ymax)\ncoord. ref. : +proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \nsource      : IA_CDL_2016.tif \ncolor table : 1 \nname        : IA_CDL_2016 \nmin value   :           0 \nmax value   :         241 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nvalues_from_rs <- terra::values(IA_cdl_stack_sr)\n\nhead(values_from_rs)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     Layer_1 IA_CDL_2016\n[1,]       0           0\n[2,]       0           0\n[3,]       0           0\n[4,]       0           0\n[5,]       0           0\n[6,]       0           0\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(IA_cdl_2015_sr)\n```\n\n::: {.cell-output-display}\n![](terra-raster-data_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "terra-raster-data_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}